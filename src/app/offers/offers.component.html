<div class="offers-container">
  <div class="header">
    <div class="header-content">
      <h1>Offers Management</h1>
       <p>Manage offers and their configurations for the offers section.</p>
    </div>
    <button class="header-action" (click)="openAddDialog()">
      <span class="icon">+</span>
      Add content
    </button>
  </div>

  <div class="tabs-container">
    <div class="tabs">
      <button 
        class="tab-btn" 
        [class.active]="activeTab() === 'dashboard'"
        (click)="setActiveTab('dashboard')">
        Dashboard
      </button>
      <button 
        class="tab-btn" 
        [class.active]="activeTab() === 'offers'"
        (click)="setActiveTab('offers')">
        Offers
      </button>
      <button 
        class="tab-btn" 
        [class.active]="activeTab() === 'whats-new'"
        (click)="setActiveTab('whats-new')">
        What's New
      </button>
    </div>
  </div>

  <div class="filters-container">
    <div class="device-filter-chips">
      <div 
        class="device-filter-chip" 
        [class.selected]="isDeviceFilterSelected('web')"
        [class.device-web]="true"
        (click)="selectDeviceFilter('web')"
      >
        🌐 Web
      </div>
      <div 
        class="device-filter-chip" 
        [class.selected]="isDeviceFilterSelected('mobile')"
        [class.device-mobile]="true"
        (click)="selectDeviceFilter('mobile')"
      >
        📱 Mobile
      </div>
    </div>

    <div class="date-filters">
      <div class="date-filter-group">
        <label for="start-date-filter" class="date-filter-label">Start:</label>
        <input 
          id="start-date-filter"
          type="date" 
          class="date-filter-input"
          [value]="startDateFilter() ? startDateFilter()!.toISOString().split('T')[0] : ''"
          (change)="setStartDateFilter($event)"
        >
      </div>
      
      <div class="date-filter-group">
        <label for="end-date-filter" class="date-filter-label">End:</label>
        <input 
          id="end-date-filter"
          type="date" 
          class="date-filter-input"
          [value]="endDateFilter() ? endDateFilter()!.toISOString().split('T')[0] : ''"
          (change)="setEndDateFilter($event)"
        >
      </div>

      @if (hasActiveDateFilters()) {
        <button class="clear-date-filters-btn" (click)="clearDateFilters()" title="Clear date filters">
          ✕
        </button>
      }
    </div>
  </div>

  <div class="offers-content">
    @if (filteredOffers().length === 0) {
      <div class="empty-state">
        <div class="empty-icon">🎁</div>
        <h3 class="empty-title">No {{ activeTab() === 'dashboard' ? 'dashboard' : activeTab() === 'offers' ? 'offers' : 'what\'s new' }} content yet</h3>
        <p class="empty-description">Create your first {{ activeTab() === 'dashboard' ? 'dashboard' : activeTab() === 'offers' ? 'offer' : 'what\'s new' }} content to get started</p>
        <button class="empty-action-btn" (click)="openAddDialog()">
          Create First {{ activeTab() === 'dashboard' ? 'Dashboard' : activeTab() === 'offers' ? 'Offer' : 'What\'s New' }} Content
        </button>
      </div>
    } @else {
      <div class="offers-grid">
        @for (offer of filteredOffers(); track offer.id) {
          <div 
            class="offer-item"
            draggable="true"
            (dragstart)="onDragStart($event, offer)"
            (dragover)="onDragOver($event)"
            (dragenter)="onDragEnter($event)"
            (dragleave)="onDragLeave($event)"
            (drop)="onDrop($event, offer)"
            (dragend)="onDragEnd($event)"
            [class.dragging]="draggedOffer()?.id === offer.id"
          >
            <ib-offer-card 
              [offer]="offer"
              (edit)="openEditDialog(offer)"
              (delete)="deleteOffer(offer.id)"
              (showStats)="showOfferStats($event)">
            </ib-offer-card>
          </div>
        }
      </div>
    }
  </div>
</div>

@if (isDialogOpen()) {
  <ib-offer-dialog
    [isOpen]="isDialogOpen()"
    [dialogType]="dialogType()"
    [dialogForm]="dialogForm()"
    (close)="closeDialog()"
    (save)="saveOffer($event)">
  </ib-offer-dialog>
}

@if (isStatsSidebarOpen() && selectedOfferForStats()) {
  <ib-offer-stats-sidebar
    [offer]="selectedOfferForStats()!"
    [isOpen]="isStatsSidebarOpen()"
    (close)="closeStatsSidebar()">
  </ib-offer-stats-sidebar>
} 